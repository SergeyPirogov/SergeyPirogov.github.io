<!DOCTYPE html>
<html lang="ru">
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="verify-admitad" content="b4f109c5f4" />

    <title>Интегрируем YAML и тестовый фреймворк</title>
    <meta name="description" content="Автоматизация рутины приоритетнее давления массой">
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta property="og:site_name" content="Заметки Автоматизатора">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Интегрируем YAML и тестовый фреймворк">
    <meta property="og:image" content="http://automation-remarks.com/images/blog-logo.png"/>

        	<meta property="og:description" content="Новая заметка, в которой я покажу, как можно использовать файлы с разширением .yml в качестве конфигурационых файлов для тестового фреймворка."/>
	
	<link rel="stylesheet" href="../css/blueimp-gallery.min.css">	
    <link rel="stylesheet" type="text/css" href="../css/dependencies.min.css"/>
    <link rel="stylesheet" href="../css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../css/style.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/blog.css" />

    <script>
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

       ga('create', 'UA-57010828-1', 'auto');
       ga('send', 'pageview');

    </script>
</head>

<body>
    <section id="wrapper">
        <div id="ajax-container">
	<script>var disqus="httpspirogovgithubio";</script>

<nav id="nav" class="nav">
        <div class="nav-panel">
          <a class="main_link" href="/">
            <span class="name">Главная</span>
          </a>
          <a class="video_link" href="https://soundcloud.com/qaguild" style="
              width: 5em;
          ">
                      <span class="name">Подкаст</span>
                    </a>
          <a class="author_link" href="/archive.html" style="
              width: 5em;
          ">
                      <span class="name">Архив</span>
                    </a>
          <a class="author_link" href="/author/">
            <span class="name">Об Авторе</span>
          </a>
          <a class="course_link" href="https://spirogov.github.io" style="
              width: 7em;
          ">
                      <span class="name">Обучение</span>
          </a>
        </div>

        <div class="nav-menu">
          <a class="rss" href="https://www.facebook.com/automationremarks"><i class="fa fa-facebook"></i></a>
          <a class="rss" href="https://vk.com/qaremarks"><i class="fa fa-vk"></i></a>
          <a class="rss" href="https://twitter.com/s_pirogov"><i class="fa fa-twitter"></i></a>
          <a class="rss" href="https://qaguild-slack.herokuapp.com/"><i class="fa fa-slack"></i></a>
        </div>
</nav>

<div id="telegram-link">
            <a id="telegram_link_text" href="https://t.me/automation_remarks">Telegram канал <i id="arrow-telegram" class="fa fa-arrow-circle-right"></i> t.me/automation_remarks
            </a>
</div>
	
	<main class="content" role="main">
		<article class="post">
			<div class="inner inner-post">
				<div id="push">
                    <header class="post-header">
                        <span class="post-meta">
                            <span class="post-author">
                                <a href="/author/index.html">Сергей Пирогов</a>
                            </span> |
                            <span class="post-date">
                                24/08/2015
                            </span>
                        </span>
                        <div class="clear"></div>
                        <h1 class="post-title">Интегрируем YAML и тестовый фреймворк</h1>
                    </header>

                    <section class="post-content">
                        <div class="paragraph">
<p>Новая заметка, в которой я покажу, как можно использовать файлы с разширением .yml в качестве конфигурационых файлов для тестового фреймворка. Хочу отметить, что я уже писал на подобную тему, только <a href="http://automation-remarks.com/zamienitie-property-faily-na-ghruvi-skripty/">тогда</a> применял <strong>Groovy</strong> файл.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://ifireball.files.wordpress.com/2015/01/yaml-logo.png" alt="yaml logo">
</div>
</div>
<div class="paragraph">
<p>Давайте посмотрим на суть задачи. Наверняка те, кто писал фреймворки на Java, пользовался стандартными файлами c расширением <strong>.proprties</strong>. Наличие проперти файлов - это правило хорошего тона.</p>
</div>
<div class="paragraph">
<p>Вся конфигурационная информация выносится за переделы кода, откуда ее можно легко изменять. Вот, скажем, стандартный пример из жизни: у нас есть несколько окружений, на которых мы запускаем наши тесты. Для каждого окружения нужны различные парметры: хост, порт и т.п. Зачастую люди делают либо разные проперти файлы и пишут Factory pattern для того, чтобы считывать из них информацию, либо делают один проперти файл, который зачастую выглядит так:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">#dev env
dev.server.host=localhost
dev.server.port=7070

#qa env
qa.server.host=qahost
qa.server.port=8081</code></pre>
</div>
</div>
<div class="paragraph">
<p>Затем пишется все та же Factory для считывания данного файла. Чего греха таить, я, бывало, тоже такое писал. Но пришло время совершенствоваться и использовать более элегантные подходы. И здесь на помощь приходит язык разметки YAML. Что это и для чего придумано, читать в Википедии ;)</p>
</div>
<div class="paragraph">
<p>Мы можем легко и просто использовать <strong>.yml</strong> файлы как замену для проперти файлов c помощью библиотеки <strong>snakeyml</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Создаем config.yml файл:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">environment:
  dev:
    server.host: http://localhost:7070
    db.url: jdbc:usernarm:userpass@test
  qa:
    server.host: http://qa.test:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь напишем класс, который будет считывать наш файл:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class YamlReader {

    public Map&lt;String, Object&gt; read(String path) throws IOException {
        InputStream in = Files.newInputStream(Paths.get(path));
        Yaml yaml = new Yaml();
        return (Map&lt;String, Object&gt;) yaml.load(in);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Читаем файл:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public static void main(String[] args) throws IOException {
        YamlReader reader = new YamlReader();
        Map&lt;String, Object&gt; config = reader.read("src/main/resources/config.yml");
        System.out.println(config);
}

Console output:
{environment={dev={server.host=http://localhost:7070, db.url=jdbc:usernarm:userpass@test}, qa={server.host=http://qa.test:8080}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Нам возвращается Map, с которой мы можем дальше работать. Но здесь есть один недостаток - casting. Нам нужно кастить каждый раз, когда мы будем доставать значение из map.</p>
</div>
<div class="paragraph">
<p>Есть гораздо лучшее решение. Cоздаем класс <strong>Configuration</strong> следующего содержания:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class Configuration {
    public Map&lt;String,Map&lt;String,String&gt;&gt; environment;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Создаем метод в ридере:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public &lt;T&gt; T read(String path, Class&lt;T&gt; c) throws IOException {
        Yaml yaml = new Yaml();
        try (InputStream in = Files.newInputStream(Paths.get(path))) {
            return yaml.loadAs(in, c);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Используем новый метод для чтения проперти:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java"> YamlReader reader = new YamlReader();
 Configuration read = reader.read("src/main/resources/config.yml", Configuration.class);

 Map&lt;String, String&gt; map = read.environment.get("qa");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Как вы могли заметить, второй подход более элегантен и удобен. Правда, вы не сможете использовать никакой другой конструкции, кроме Map; в первом же случае вы вольны кастить значения к тому типу, к которому душе угодно. На этом у меня все. Подписывайтесь, чтобы держать руку на пульсе.</p>
</div>
                    </section>

                    <footer class="post-footer">
                            <div class="post-tags">
                                    <a style="background: cornflowerblue;"
                                       href="/tags/Тест-фреймворк.html">Тест фреймворк</a>
                                    <a style="background: cornflowerblue;"
                                       href="/tags/Java.html">Java</a>
                            </div>
                    </footer>

                    <div class="row">
                        <h2 style="margin-top: 20px;">Слушайте QAGuild подкаст</h2>
                        <iframe width="100%" height="450" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/playlists/692858805&color=%23ff5500&auto_play=false&hide_related=true&show_comments=true&show_user=true&show_reposts=false&show_teaser=true"></iframe>
                    </div>

                    <div class="row">
                          <div class="col-md-6">
                                <div class='related-posts-holder'>
                                     <h2>Похожие заметки:</h2>
                                     <ul class="related-posts">
                                                <li><a class='js-ajax-link' href="/2020/qaguild-live21/index.html">QAGuild live #21: Про отчеты в автотестах</a></li>
                                                <li><a class='js-ajax-link' href="/2019/qaguild-live20/index.html">QAGuild live #20: Что ждет тестировщика в 2020 году</a></li>
                                                <li><a class='js-ajax-link' href="/2019/qaguild-live19/index.html">QAGuild live #19: Чемпионат по автоматизации тестирования на Java</a></li>
                                                <li><a class='js-ajax-link' href="/2019/qaguild-live18/index.html">QAGuild live #18: Про GitHub в резюме тестировщика</a></li>
                                                <li><a class='js-ajax-link' href="/2019/black-friday-2019/index.html">Черная пятница от automation-remarks.com</a></li>
                                                <li><a class='js-ajax-link' href="/2019/qaguild-s2e11/index.html">S2E11: Про тестирование контрактов</a></li>
                                                <li><a class='js-ajax-link' href="/2019/qaguild-live17/index.html">QAGuild live #17: Про умение объяснять для тестировщика</a></li>
                                     </ul>
                                 </div>
                          </div>
                          <div class="col-md-6">

                          </div>
                    </div>
				</div>

				 <!-- Begin MailChimp Signup Form -->
                                   <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
                                   <style type="text/css">
                                   	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
                                   	/* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
                                   	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
                                   </style>
                                   <div id="mc_embed_signup">
                                   <form action="//automation-remarks.us10.list-manage.com/subscribe/post?u=d24f95005c1b66c13389aceb9&amp;id=ce47ec0c3f" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                                       <div id="mc_embed_signup_scroll">
                                   	<label for="mce-EMAIL">Подписывайтесь на email рассылку</label>
                                   	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
                                       <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                                       <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_d24f95005c1b66c13389aceb9_ce47ec0c3f" tabindex="-1" value=""></div>
                                       <div class="clear"><input type="submit" value="Подписаться" name="subscribe" id="mc-embedded-subscribe" class="button" style="background: black;"></div>
                                       </div>
                                   </form>
                                   </div>

                                   <!--End mc_embed_signup-->

				<aside class="post-comments">
                    <div id="disqus_thread">
                        <script async="async">(function(d, s, id) {
                                  var js, fjs = d.getElementsByTagName(s)[0];
                                  if (d.getElementById(id)) return;
                                  js = d.createElement(s); js.id = id;
                                  js.src = "//connect.facebook.net/ru_RU/sdk.js#xfbml=1&version=v2.5&appId=344312565764603";
                                  fjs.parentNode.insertBefore(js, fjs);
                                }(document, 'script', 'facebook-jssdk'));
                        </script>
                    </div>
                </aside>
			</div>
		</article>
	</main>

            <footer id="footer">
              <section class="credits">
                <span class="credits-software">Published with <a href="http://jbake.org/">JBake</a></span>
              </section>
            </footer>
         </div>
    </section>

    <script type="text/javascript" src="../js/dependencies.min.js"></script>
    <script type="text/javascript" src="../js/script.js" async="async"></script>
    <script src="//my.hellobar.com/b89babe68c85bfcf7416926983e86b31a9467186.js" type="text/javascript" charset="utf-8" async="async"></script>
</body>
</html>