<!DOCTYPE html>
<html lang="ru">
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="verify-admitad" content="b4f109c5f4" />

    <title>Как автоматизатору побороть SSH</title>
    <meta name="description" content="Автоматизация рутины приоритетнее давления массой">
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta property="og:site_name" content="Заметки Автоматизатора">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Как автоматизатору побороть SSH">
    <meta property="og:image" content="http://automation-remarks.com/images/blog-logo.png"/>

        	<meta property="og:description" content="Я решил не тратить время попусту и в этот короткий промежуток между праздниками написать небольшую заметку."/>
	
	<link rel="stylesheet" href="../css/blueimp-gallery.min.css">	
    <link rel="stylesheet" type="text/css" href="../css/dependencies.min.css"/>
    <link rel="stylesheet" href="../css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../css/style.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/blog.css" />

    <script>
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

       ga('create', 'UA-57010828-1', 'auto');
       ga('send', 'pageview');

    </script>
</head>

<body>
    <section id="wrapper">
        <div id="ajax-container">
	<script>var disqus="httpspirogovgithubio";</script>

<nav id="nav" class="nav">
        <div class="nav-panel">
          <a class="main_link" href="/">
            <span class="name">Главная</span>
          </a>
          <a class="video_link" href="/podcast" style="
              width: 5em;
          ">
                      <span class="name">Подкаст</span>
                    </a>
          <a class="author_link" href="/archive.html" style="
              width: 5em;
          ">
                      <span class="name">Архив</span>
                    </a>
          <a class="author_link" href="/author/">
            <span class="name">Об Авторе</span>
          </a>
          <a class="course_link" href="https://spirogov.github.io" style="
              width: 7em;
          ">
                      <span class="name">Обучение</span>
          </a>
        </div>

        <div class="nav-menu">
          <a class="rss" href="https://www.facebook.com/automationremarks"><i class="fa fa-facebook"></i></a>
          <a class="rss" href="https://vk.com/qaremarks"><i class="fa fa-vk"></i></a>
          <a class="rss" href="https://twitter.com/s_pirogov"><i class="fa fa-twitter"></i></a>
          <a class="rss" href="https://qaguild-slack.herokuapp.com/"><i class="fa fa-slack"></i></a>
        </div>
</nav>
	
	<main class="content" role="main">
		<article class="post">
			<div class="inner inner-post">
				<div id="push">
                    <header class="post-header">
                        <span class="post-meta">
                            <span class="post-author">
                                <a href="/author/index.html">Сергей Пирогов</a>
                            </span> |
                            <span class="post-date">
                                03/01/2016
                            </span>
                        </span>
                        <div class="clear"></div>
                        <h1 class="post-title">Как автоматизатору побороть SSH</h1>
                    </header>

                    <section class="post-content">
                        <div class="paragraph">
<p>Хоу-хоу, надеюсь все отлично встретили Новый год и теперь ждут Рождества. Я решил не тратить время попусту и в этот короткий промежуток между праздниками написать небольшую заметку. В этот раз напишу о возможных вариантах работы с <strong>SSH</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://encrypted-tbn2.gstatic.com/images?q=tbn:ANd9GcSIluTpLycP4jpvVo3Y0WeOulr4QuhdBSp4Yg6r1doJY4IEX0wx0Q" alt="images?q=tbn:ANd9GcSIluTpLycP4jpvVo3Y0WeOulr4QuhdBSp4Yg6r1doJY4IEX0wx0Q">
</div>
</div>
<div class="paragraph">
<p>Я думаю, что люди, работающие с Linux, имеют достаточно хороший опыт работы с ssh. Для тех же, кто не знает и не пробовал, рекомендую почитать про <strong>ssh</strong>, <strong>putty</strong>, установить виртуалку с помощью <a href="http://automation-remarks.com/vagrant/">Vagrant</a> и поиграться.</p>
</div>
<div class="paragraph">
<p>Приступим ближе к делу: зачем оно автоматизаторам и зачем я вообще затронул эту тему? Все очень просто! Если у вас на проекте есть linux сервера, то вам не избежать работы с ssh. У меня был опыт реализации такой задачи, когда нам нужно было закидывать конфигурационные файлы на сервер и смотреть, как себя поведет система после таких изменений. Делать это руками интересно, но только в первый раз =) Я заавтоматизировал этот процесс.</p>
</div>
<div class="paragraph">
<p>Тогда я был маленьким джуниором и мое решение свелось к использованию библиотеки <strong>Jsch</strong>. Штука работала, но пришлось нахвататься проблем и опыта. Не буду вдаваться в подробности, просто посмотрите пример реализации <a href="http://www.jcraft.com/jsch/examples/Shell.java.html">здесь</a>.</p>
</div>
<div class="paragraph">
<p>Гораздо проще пользоваться библиотеками-обертками, к примеру <a href="http://ssh.jcabi.com/">Jcabi-ssh</a>. Здесь и кода меньше и выглядит он поприятнее:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import com.jcabi.ssh.Shell;
import com.jcabi.ssh.SSH;
Shell shell = new SSH("example.com", 22, "username", "password");
String stdout = new Shell.Plain(shell).exec("echo 'Hello, world!'");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Но все равно как-то выглядит не очень элегантно.</p>
</div>
<div class="paragraph">
<p>Абсолютным победителем для меня является библиотека - <a href="https://github.com/aestasit/sshoogr">sshoogr</a>. По сути - это Groovy DSL для работы с SSH.</p>
</div>
<div class="paragraph">
<p>Посмотрите, как легко с ней работать:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Grab('com.aestasit.infrastructure.sshoogr:sshoogr:0.9.18')
import static com.aestasit.infrastructure.ssh.DefaultSsh.*

remoteSession('user2:654321@localhost:2222') {
  exec 'rm -rf /tmp/*'
  exec 'touch /var/lock/my.pid'
  remoteFile('/var/my.conf').text = "enabled=true"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Что стало для меня самым приятным, так это работа с файлами. К примеру:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">def file = "/root/home/test.txt"
 def selenium = "selenium-server-standalone-2.48.2.jar"

 //write to file
 remoteFile(file).text = "Hello"

 //read from file
 print remoteFile(file).text

 //copy file to remote host
 scp {
      from { localFile "/root/home/${selenium}"}
      into { remoteFile "/root/remote/${selenium}" }
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Вот как можно легко и просто делать вещи. Не нужно париться с тысячей try-catch блоков, просто бери и делай. А самое важное здесь то, что все это является кодом, вы можете писать свои функции и использовать их, вы можете использовать мощь <strong>GString</strong> для параметризации и многие другие фишки <strong>Groovy</strong>. Я жалею, что узнал о ней только когда начал разбираться с <strong>Groovy</strong>.</p>
</div>
<div class="paragraph">
<p><strong>P.S</strong></p>
</div>
<div class="paragraph">
<p>В бочке меда не без ложки дегтя: у меня почему-то не сработал вариант конфигурации:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">remoteSession {

  host = 'localhost'
  username = 'user2'
  password = '654321'
  port = 2222

  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Возможно, я что-то недосмотрел, но во всех остальных случаях работает отлично. На этом все! спасибо, что читали. Возможно, эта заметка поможет в будущем решать подобные проблемы проще и эффективнее. Счастливого Рождества всем! Подписывайтесь - в 2016 будем на связи&#8230;&#8203;</p>
</div>
                    </section>

                    <footer class="post-footer">
                            <div class="post-tags">
                                    <a style="background: cornflowerblue;"
                                       href="/tags/Тест-фреймворк.html">Тест фреймворк</a>
                                    <a style="background: cornflowerblue;"
                                       href="/tags/Java.html">Java</a>
                                    <a style="background: cornflowerblue;"
                                       href="/tags/Groovy.html">Groovy</a>
                            </div>
                    </footer>

                    <div class="row">
                        <h2 style="margin-top: 20px;">Слушайте QAGuild подкаст</h2>
                        <iframe width="100%" height="450" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/playlists/422684588&color=%238c8c64&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true" style="margin-bottom: unset;"></iframe>
                    </div>

                    <div class="row">
                          <div class="col-md-6">
                                <div class='related-posts-holder'>
                                     <h2>Похожие заметки:</h2>
                                     <ul class="related-posts">
                                                <li><a class='js-ajax-link' href="/2018/qa-guild-ep15/index.html">QA Guild Podcast #15: Про тестатоны</a></li>
                                                <li><a class='js-ajax-link' href="/2018/qa-guild-ep14/index.html">QA Guild Podcast: О том, через какие курсы лучше "Войти в АйТи" (18+)</a></li>
                                                <li><a class='js-ajax-link' href="/2018/consulting/index.html">Консультации для автоматизаторов</a></li>
                                                <li><a class='js-ajax-link' href="/2018/qa-guild-ep12/index.html">QA Guild Podcast: Дария Бондарева о том, как тестировать AR</a></li>
                                                <li><a class='js-ajax-link' href="/2018/qa-guild-ep10/index.html">QA Guild Podcast: Святослав Логин о том как войти в секьюрити тестирование и защититься от веб-бандитов</a></li>
                                                <li><a class='js-ajax-link' href="/2018/ansible/index.html">Ansible для лучшей автоматизации</a></li>
                                                <li><a class='js-ajax-link' href="/2018/gradle-testng/index.html">Учим Gradle менять потоки в TestNG</a></li>
                                     </ul>
                                 </div>
                          </div>
                          <div class="col-md-6">

                          </div>
                    </div>
				</div>

				 <!-- Begin MailChimp Signup Form -->
                                   <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
                                   <style type="text/css">
                                   	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
                                   	/* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
                                   	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
                                   </style>
                                   <div id="mc_embed_signup">
                                   <form action="//automation-remarks.us10.list-manage.com/subscribe/post?u=d24f95005c1b66c13389aceb9&amp;id=ce47ec0c3f" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                                       <div id="mc_embed_signup_scroll">
                                   	<label for="mce-EMAIL">Подписывайтесь на email рассылку</label>
                                   	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
                                       <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                                       <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_d24f95005c1b66c13389aceb9_ce47ec0c3f" tabindex="-1" value=""></div>
                                       <div class="clear"><input type="submit" value="Подписаться" name="subscribe" id="mc-embedded-subscribe" class="button" style="background: black;"></div>
                                       </div>
                                   </form>
                                   </div>

                                   <!--End mc_embed_signup-->

				<aside class="post-comments">
                    <div id="disqus_thread">
                        <script async="async">(function(d, s, id) {
                                  var js, fjs = d.getElementsByTagName(s)[0];
                                  if (d.getElementById(id)) return;
                                  js = d.createElement(s); js.id = id;
                                  js.src = "//connect.facebook.net/ru_RU/sdk.js#xfbml=1&version=v2.5&appId=344312565764603";
                                  fjs.parentNode.insertBefore(js, fjs);
                                }(document, 'script', 'facebook-jssdk'));
                        </script>
                    </div>
                </aside>
			</div>
		</article>
	</main>

            <footer id="footer">
              <section class="credits">
                <span class="credits-software">Published with <a href="http://jbake.org/">JBake</a></span>
              </section>
            </footer>
         </div>
    </section>

    <script type="text/javascript" src="../js/dependencies.min.js"></script>
    <script type="text/javascript" src="../js/script.js" async="async"></script>
    <script src="//my.hellobar.com/b89babe68c85bfcf7416926983e86b31a9467186.js" type="text/javascript" charset="utf-8" async="async"></script>
</body>
</html>