<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Заметки Автоматизатора</title>
    <meta name="description" content="Автоматизация рутины приоритетнее давления массой">
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../css/dependencies.css"/>
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <link rel="stylesheet" type="text/css" href="../css/blog.css" />

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter28753121 = new Ya.Metrika({
                        id:28753121,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true,
                        webvisor:true
                    });
                } catch(e) { }
            });

            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://mc.yandex.ru/metrika/watch.js";

            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else { f(); }
        })(document, window, "yandex_metrika_callbacks");
    </script>
    <noscript>
    <div><img src="https://mc.yandex.ru/watch/28753121" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    <script>var disqus="httpspirogovgithubio";</script>

</head>

<body>
    <section id="wrapper">
        <div id="ajax-container">	
<nav id="nav" class="nav">
        <div class="nav-panel">
          <a class="main_link" href="/">
            <span class="name">Главная</span>
          </a>
          <a class="video_link" href="/tags/Видео.html">
            <span class="name">Видео</span>
          </a>
          <a class="author_link" href="/archive.html">
            <span class="name">Архив</span>
          </a>
          <a class="author_link" href="/author/">
            <span class="name">Об Авторе</span>
          </a>
        </div>

        <div class="nav-menu">
          <a class="rss" href="https://www.facebook.com/automationremarks"><i class="fa fa-facebook"></i></a>
          <a class="rss" href="https://vk.com/qaremarks"><i class="fa fa-vk"></i></a>
          <a class="rss" href="https://twitter.com/s_pirogov"><i class="fa fa-twitter"></i></a>
          <a class="rss" href="/rss/index.rss"><i class="fa fa-rss"></i></a>
        </div>
</nav>	
	<main class="content" role="main">
		<article class="post">
			<div class="inner inner-post">
				<div id="push">
                    <header class="post-header">
                        <span class="post-meta">
                            <span class="post-author">Сергей Пирогов</span> | <span class="post-date">02/08/2015</span>
                        </span>
                        <div class="clear"></div>
                        <h1 class="post-title">Делаем тесты читабельнее. Кастомный Matcher</h1>
                    </header>

                    <section class="post-content">
                        <div class="paragraph">
<p>Новая заметка о том, как сделать тесты читабельнее. Я уже писал <a href="http://automation-remarks.com/davaitie-poghovorim-pro-asserty/">заметку</a> про библиотеки, которые помогают писать простые ассерты. Зачастую функциональности, которую предоставляют эти библиотеки, хватает для написания читабельных тестов. Но мы же идем путем улучшения. Бывают случаи, когда нужно написать свой собственный матчер, чтобы упростить ассерт или сделать его читабельнее.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://automation-remarks.com/content/images/2015/08/debrief.gif" alt="debrief">
</div>
</div>
<div class="paragraph">
<p>Зачем вообще это нужно? Скажем, у вас есть инстанс HttpResponse и вам нужно проверить его параметры.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Test
public void testSpeller() throws Exception {
        ResponseEntity&lt;String&gt; response = restTemplate.getForEntity("http://speller.yandex.net/services/spellservice.json/checkText?text=синхрафазатрон+в+дубне", String.class);

//typical
assertThat(response.getStatusCode(),equalTo(HttpStatus.OK));

//custom
assertThat(response,code(OK));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Этот пример наглядно показывает, что с применением кастомных матчеров код становится читабельнее. Нужно отметить, что существует определенное количество библиотек, которые позволяют использовать готовые матчеры. К примеру, набор матчеров от <strong>Yandex</strong>. Брать чужое и пользоваться - это хорошо, но еще лучше уметь написать свой матчер. Приступим к написанию <strong>hamcrest</strong> матчера.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import org.hamcrest.Description;
import org.hamcrest.Matcher;
import org.hamcrest.TypeSafeMatcher;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;

/**
 * Created by sergey on 02.08.15.
 */
public class HttpResponseCodeMatcher extends TypeSafeMatcher&lt;ResponseEntity&lt;String&gt;&gt; {

     private HttpStatus status;

    public HttpResponseCodeMatcher(HttpStatus status) {
        this.status = status;
    }

    @Override
    protected boolean matchesSafely(ResponseEntity&lt;String&gt; response) {
        return response.getStatusCode().equals(status);
    }

    @Override
    public void describeTo(Description description) {
        description.appendText("status code: ").appendValue(status);
    }

    @Override
    protected void describeMismatchSafely(ResponseEntity&lt;String&gt; item, Description mismatchDescription) {
        mismatchDescription.appendText("was: ").appendValue(item.getStatusCode());
    }

    public static Matcher&lt;ResponseEntity&lt;String&gt;&gt; code(HttpStatus status) {
        return new HttpResponseCodeMatcher(status);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Все, что нам нужно, - это просто наследовать класс <strong>TypeSafeMatcher</strong> и реализовать три метода. Нужно быть внимательным: третий метод <strong>describeMismatchSafely</strong> не является абстрактным, по умолчанию он будет выводить результат, просто вызывая на объекте <strong>toString()</strong>. Мы же переопределили этот метод и в результате у нас получается такой вот код:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@Test
public void testSpeller() throws Exception {
   ResponseEntity&lt;String&gt; response = restTemplate.getForEntity("http://speller.yandex.net/services/spellservice.json/checkText?text=синхрафазатрон+в+дубне", String.class);
   assertThat(response, code(ACCEPTED));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>И такое сообщение об ошибке:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">java.lang.AssertionError:
Expected: status code: <b class="conum">(202)</b>
     but: was: <b class="conum">(200)</b>
    at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)
    at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:8)
    at com.matcher.MatcherTest.testSpeller(MatcherTest.java:62)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ну вот, очень легко и просто мы написали свой матчер и улучшили читабельность наших тестов. Более того, кастомные матчеры очень хороши при использовании <strong>Spock Framework</strong> в качестве тест ранера. Но это уже история следующей заметки. Подписывайтесь, чтобы получать заметки первыми. До встреч&#8230;&#8203;</p>
</div>
                    </section>

                    <footer class="post-footer">
                            <div class="post-tags">
                                    <a href="/tags/Тест-фреймворк.html">Тест фреймворк</a>
                                    <a href="/tags/Java.html">Java</a>
                            </div>
                        <div class="post-share">
                            <a class="icon-twitter" href="https://twitter.com/share?text=Делаем тесты читабельнее. Кастомный Matcher&url=custom-matcher/index.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                                <span>Twitter</span>
                            </a>
                            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=custom-matcher/index.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                                <span>Facebook</span>
                            </a>
                            <a class="icon-gplus" href="https://plus.google.com/share?url=custom-matcher/index.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                                <span>Google+</span>
                            </a>
                        </div>
                    </footer>



                    <div class="row">
                          <div class="col-md-6">
                                <div class='related-posts-holder'>
                                     <h2>Похожие заметки:</h2>
                                     <ul class="related-posts">
                                                <li><a class='js-ajax-link' href="/budtie-ostorozhny-s-testng-lisienierami/index.html">Будьте осторожны с TestNG лисенерами</a></li>
                                                <li><a class='js-ajax-link' href="/qafest-2016-rietrospiektiva/index.html">QAFest 2016: ретроспектива</a></li>
                                                <li><a class='js-ajax-link' href="/anons-sqa-days-19/index.html">Анонс SQA Days 19</a></li>
                                                <li><a class='js-ajax-link' href="/working-with-database/index.html">Работа с базой данных без боли и страданий</a></li>
                                                <li><a class='js-ajax-link' href="/ssh/index.html">Как автоматизатору побороть SSH</a></li>
                                                <li><a class='js-ajax-link' href="/groovy-matcher/index.html">Делаем матчеры веселее с Groovy</a></li>
                                                <li><a class='js-ajax-link' href="/performance-lecture/index.html">Введение в нагрузочное тестирование</a></li>
                                     </ul>
                                 </div>
                          </div>
                          <div class="col-md-6">

                          </div>
                    </div>
				</div>
				<aside class="post-comments">
                    <div id="disqus_thread">
                        <script async="async">(function(d, s, id) {
                                  var js, fjs = d.getElementsByTagName(s)[0];
                                  if (d.getElementById(id)) return;
                                  js = d.createElement(s); js.id = id;
                                  js.src = "//connect.facebook.net/ru_RU/sdk.js#xfbml=1&version=v2.5&appId=344312565764603";
                                  fjs.parentNode.insertBefore(js, fjs);
                                }(document, 'script', 'facebook-jssdk'));
                        </script>
                    </div>
                </aside>
			</div>
		</article>
	</main>

            <footer id="footer">
              <section class="credits">
                <span class="credits-software">Published with <a href="http://jbake.org/">JBake</a></span>
              </section>
            </footer>
         </div>
    </section>
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="../js/dependencies.js"></script>
    <script type="text/javascript" src="../js/script.js"></script>
    <script type="text/javascript" src="../js/index.js"></script>
    <script src="//my.hellobar.com/b89babe68c85bfcf7416926983e86b31a9467186.js" type="text/javascript" charset="utf-8" async="async"></script>
</body>
</html>