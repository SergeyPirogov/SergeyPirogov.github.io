<!DOCTYPE html>
<html lang="ru">
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="verify-admitad" content="b4f109c5f4" />

    <title>Переходим на Allure2 без Gradle плагина</title>
    <meta name="description" content="Автоматизация рутины приоритетнее давления массой">
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta property="og:site_name" content="Заметки Автоматизатора">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Переходим на Allure2 без Gradle плагина">
    <meta property="og:image" content="http://automation-remarks.com/images/blog-logo.png"/>

        	<meta property="og:description" content="Способ интеграции Allure2 и Gradle"/>
	
	<link rel="stylesheet" href="../../css/blueimp-gallery.min.css">	
    <link rel="stylesheet" type="text/css" href="../../css/dependencies.min.css"/>
    <link rel="stylesheet" href="../../css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../../css/style.min.css" />
    <link rel="stylesheet" type="text/css" href="../../css/blog.css" />

    <script>
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

       ga('create', 'UA-57010828-1', 'auto');
       ga('send', 'pageview');

    </script>
</head>

<body>
    <section id="wrapper">
        <div id="ajax-container">
	<script>var disqus="httpspirogovgithubio";</script>

<nav id="nav" class="nav">
        <div class="nav-panel">
          <a class="main_link" href="/">
            <span class="name">Главная</span>
          </a>
          <a class="video_link" href="/podcast" style="
              width: 5em;
          ">
                      <span class="name">Подкаст</span>
                    </a>
          <a class="author_link" href="/archive.html" style="
              width: 5em;
          ">
                      <span class="name">Архив</span>
                    </a>
          <a class="author_link" href="/author/">
            <span class="name">Об Авторе</span>
          </a>
          <a class="course_link" href="https://spirogov.github.io" style="
              width: 7em;
          ">
                      <span class="name">Обучение</span>
          </a>
        </div>

        <div class="nav-menu">
          <a class="rss" href="https://www.facebook.com/automationremarks"><i class="fa fa-facebook"></i></a>
          <a class="rss" href="https://vk.com/qaremarks"><i class="fa fa-vk"></i></a>
          <a class="rss" href="https://twitter.com/s_pirogov"><i class="fa fa-twitter"></i></a>
          <a class="rss" href="https://qaguild-slack.herokuapp.com/"><i class="fa fa-slack"></i></a>
        </div>
</nav>
	
	<main class="content" role="main">
		<article class="post">
			<div class="inner inner-post">
				<div id="push">
                    <header class="post-header">
                        <span class="post-meta">
                            <span class="post-author">
                                <a href="/author/index.html">Сергей Пирогов</a>
                            </span> |
                            <span class="post-date">
                                18/06/2017
                            </span>
                        </span>
                        <div class="clear"></div>
                        <h1 class="post-title">Переходим на Allure2 без Gradle плагина</h1>
                    </header>

                    <section class="post-content">
                        <div class="paragraph">
<p>После пары заметок о конференциях <a href="http://automation-remarks.com/2017/testing-stage-retro/index.html">Testing Stage</a> и <a href="http://automation-remarks.com/2017/heisenbug-2017-piter-retro/index.html">Гейзенбаг</a>
пришла пора возвращаться к техническому хардкору. В этот раз я вам расскажу о способе интеграции Allure2 и Gradle.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://automated-testing.info/uploads/default/original/2X/3/3a722f96e5c6db7ef7a54773d73a81633ba2f828.png" alt="3a722f96e5c6db7ef7a54773d73a81633ba2f828">
</div>
</div>
<div class="paragraph">
<p>Скажу сразу, данный способ будет валиден до выхода в релиз официального плагина Allure2 для Gradle. Пока же работающего плагина нет, придется позаниматься извращением.</p>
</div>
<div class="paragraph">
<p>Настраивать будем для Gradle 3 и TestNG. В принципе, все необходимое можно найти в <a href="https://docs.qameta.io/allure/2.0/">официальной документации</a> по Allure2.</p>
</div>
<div class="paragraph">
<p>Добавляем настройки в build.gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>apply plugin: 'java'

configurations {
    agent
}

dependencies {
    agent "org.aspectj:aspectjweaver:1.8.10"
    compile "io.qameta.allure:allure-testng:2.0-BETA10"
}

test.doFirst {
    jvmArgs "-javaagent:${configurations.agent.singleFile}"
}

test {
    useTestNG()
    systemProperty 'allure.results.directory', 'build/allure-results'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь при прогоне тестов через command line или CI c помощью команды:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>./gradlew clean test</code></pre>
</div>
</div>
<div class="paragraph">
<p>У вас в папке <code>build/allure-results</code> будут создаваться *.json файлы, из которых потом и будет генерироваться отчет.</p>
</div>
<div class="paragraph">
<p>Этого вполне достаточно, если вы запускаете тесты на CI и используете Allure2 плагин для генерации отчета. Увы, ставить плагины и обновлять
не всегда выдается возможным, так как наш Jenkins содержат дяди с тайтлом "DevOps". Благо, уже давно есть HTML Publisher плагин, который позволяет рендерить
сгенерированный отчет. Именно им мы и пользуемся.</p>
</div>
<div class="paragraph">
<p>Для того, чтобы сгенерировать отчет, нужно использовать <a href="https://docs.qameta.io/allure/2.0/#_installing_a_commandline">allure command line</a>.</p>
</div>
<div class="paragraph">
<p>Но я уже привык к тому, что вызываю <code>gradle clean test</code>, и у меня после прогона тестов всегда генерируется отчет. Чтобы такого добиться с Allure2,
нужно самим пописать код.</p>
</div>
<div class="paragraph">
<p>Идем, значит, в <a href="https://bintray.com/qameta/generic/allure2">bintray</a> и качаем allure command line binary архив.
Распаковываем и ложим в корень нашего проекта.</p>
</div>
<div class="paragraph">
<p>Дальше делаем свой таск в build.gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>task generateAllure(type: Exec) {
    workingDir "$projectDir/allure/bin"
    if (System.getProperty('os.name').toLowerCase(Locale.ROOT).contains('windows')) {
        commandLine 'cmd', '/c', 'allure.bat', 'generate', '-c', '../../integration/build/allure-results'
    } else {
        commandLine 'bash', '-c', 'allure', 'generate', '-c',"$projectDir/integration/build/allure-results"
    }
}

tasks.withType(Test)*.finalizedBy generateAllure</code></pre>
</div>
</div>
<div class="paragraph">
<p>Собственно, на этом и все. Теперь при выполнении <code>gradlew clean test</code> у нас будут прогоняться тесты и генерироваться отчет.</p>
</div>
<div class="paragraph">
<p>Про Allure2 и Python вы сможете послушать на <a href="http://automation-remarks.com/2017/python-training/index.html">мастер-классе</a>, который назначен на 24.06.17.</p>
</div>
                    </section>

                    <footer class="post-footer">
                            <div class="post-tags">
                                    <a style="background: cornflowerblue;"
                                       href="/tags/Java.html">Java</a>
                                    <a style="background: cornflowerblue;"
                                       href="/tags/Allure.html">Allure</a>
                            </div>
                    </footer>

                    <div class="row">
                        <h2 style="margin-top: 20px;">Слушайте QAGuild подкаст</h2>
                        <iframe width="100%" height="450" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/playlists/422684588&color=%238c8c64&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true" style="margin-bottom: unset;"></iframe>
                    </div>

                    <div class="row">
                          <div class="col-md-6">
                                <div class='related-posts-holder'>
                                     <h2>Похожие заметки:</h2>
                                     <ul class="related-posts">
                                                <li><a class='js-ajax-link' href="/2018/qa-guild-ep12/index.html">QA Guild Podcast: Дария Бондарева о том, как тестировать AR</a></li>
                                                <li><a class='js-ajax-link' href="/2018/qa-guild-ep10/index.html">QA Guild Podcast: Святослав Логин о том как войти в секьюрити тестирование и защититься от веб-бандитов</a></li>
                                                <li><a class='js-ajax-link' href="/2018/ansible/index.html">Ansible для лучшей автоматизации</a></li>
                                                <li><a class='js-ajax-link' href="/2018/gradle-testng/index.html">Учим Gradle менять потоки в TestNG</a></li>
                                                <li><a class='js-ajax-link' href="/2018/qa-guild-ep7/index.html">QA Guild Podcast: Многообещающий JavaScript</a></li>
                                                <li><a class='js-ajax-link' href="/2018/se-2018-video/index.html">Видео с SeleniumCamp 2018</a></li>
                                                <li><a class='js-ajax-link' href="/2018/kotlin-autotest-2018/index.html">Kotlin для автотестов: боевой опыт</a></li>
                                     </ul>
                                 </div>
                          </div>
                          <div class="col-md-6">

                          </div>
                    </div>
				</div>

				 <!-- Begin MailChimp Signup Form -->
                                   <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
                                   <style type="text/css">
                                   	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
                                   	/* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
                                   	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
                                   </style>
                                   <div id="mc_embed_signup">
                                   <form action="//automation-remarks.us10.list-manage.com/subscribe/post?u=d24f95005c1b66c13389aceb9&amp;id=ce47ec0c3f" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                                       <div id="mc_embed_signup_scroll">
                                   	<label for="mce-EMAIL">Подписывайтесь на email рассылку</label>
                                   	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
                                       <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                                       <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_d24f95005c1b66c13389aceb9_ce47ec0c3f" tabindex="-1" value=""></div>
                                       <div class="clear"><input type="submit" value="Подписаться" name="subscribe" id="mc-embedded-subscribe" class="button" style="background: black;"></div>
                                       </div>
                                   </form>
                                   </div>

                                   <!--End mc_embed_signup-->

				<aside class="post-comments">
                    <div id="disqus_thread">
                        <script async="async">(function(d, s, id) {
                                  var js, fjs = d.getElementsByTagName(s)[0];
                                  if (d.getElementById(id)) return;
                                  js = d.createElement(s); js.id = id;
                                  js.src = "//connect.facebook.net/ru_RU/sdk.js#xfbml=1&version=v2.5&appId=344312565764603";
                                  fjs.parentNode.insertBefore(js, fjs);
                                }(document, 'script', 'facebook-jssdk'));
                        </script>
                    </div>
                </aside>
			</div>
		</article>
	</main>

            <footer id="footer">
              <section class="credits">
                <span class="credits-software">Published with <a href="http://jbake.org/">JBake</a></span>
              </section>
            </footer>
         </div>
    </section>

    <script type="text/javascript" src="../../js/dependencies.min.js"></script>
    <script type="text/javascript" src="../../js/script.js" async="async"></script>
    <script src="//my.hellobar.com/b89babe68c85bfcf7416926983e86b31a9467186.js" type="text/javascript" charset="utf-8" async="async"></script>
</body>
</html>